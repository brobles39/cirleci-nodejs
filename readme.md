# Demo NodeJs CircleCI

This NodeJS is forked from Lissy93/quick-example-of-testing-in-nodejs.

The main objective of this project is to show the process of building and testing a NodeJS application in CircleCi.

## Full youtube video

```bash
https://www.youtube.com/watch?v=og9wm5NMoxA
```

## Local testing

### Installation

Clone this repo.

```bash
git clone https://github.com/brobles39/cirleci-nodejs.git
```

Install dependencies.

```bash
npm install
```
Run the app.

```bash
npm run start
```

**Running tests locally.**

Unit tests.
```bash
npm run test
```

Coverage test
```bash
npm run coverage
```

## CI/CD Process

Github actions was used as a CI/CD tool, basically it installs the project dependencies, logs into my personal dockerhub account, builds the application and uploads it to my dockerhub account.

As variables it has configured a dockerhub token to access the account, as well as the credentials of my personal aws account and the KUBECONFIG_FILE in base64 to point to my EKS cluster.

**Full Pipeline description:**

This CircleCI pipeline configuration performs a build and test workflow for a Node.js project. Let's break down the configuration and describe each section:

**1. version** The pipeline is defined with the version 2.1.

**2. orbs**  The node orb is included, specifically version circleci/node@5.0.2. Orbs are reusable packages that contain pre-defined commands and configurations for common tasks.

**3. executor** The node14 executor is defined using a Docker image based on Node.js version 14.18.2. It is configured with a medium resource class.

**4. custome command** A custom command called nodesetup is defined. It checks out the code, restores the cache, saves the cache, and installs project dependencies.

**5. job** The build_and_test job is defined, which uses the node14 executor. It consists of multiple steps:

  **5.1 nodesetup** .The nodesetup command is executed.

  **5.2 coverage test** A run step runs the test command using npm run coverage.

  **5.3 restoring cache** The restore_cache step restores the cache using the specified cache key.

  **5.5 coverage information** Another run step processes the coverage information generated by the tests.

  **5.6 saving cache for the next execution** The save_cache step saves the coverage information as a cache using the specified cache key.

  **5.7 storing artifacts** The store_artifacts step saves the coverage reports as artifacts.

  **5.8 workflow definition** The workflows section defines the node_build_pipeline workflow, which includes the build_and_test job.

This pipeline essentially checks out the code, sets up the Node.js environment, installs dependencies, runs tests, processes the coverage information, and saves the coverage reports as artifacts. The pipeline is triggered when changes are pushed to the repository.

## License

Copyright Â© 2023 Brian Robles. All rights reserved.